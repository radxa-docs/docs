import { Image } from "@site/src/utils/docs";

主要介绍如何将 FEL 系统镜像安装到板载 eMMC 或 eMMC 模块中。

:::warning
安装系统会格式化 eMMC，如果有重要数据请提前备份！
:::

## 使用前提

### 硬件连接

<Tabs queryString="system boot">
<TabItem value="eMMC 模块" default={props.tag === "emmc_module"} attributes={{className: props.tag === "emmc_board" && "tab_none"}} >

eMMC 模块安装步骤：

1. 观察 eMMC 模块上的缺角方向和主板上的 eMMC 模块接口的缺角丝印，以确定正确的安装方向。
2. 将 eMMC 模块放置到主板 eMMC 模块接口上方，确保 eMMC 模块接口与主板的 eMMC 模块接口基本对齐。
3. 稍用力按压 eMMC 模块的一端，听到“咔哒”声表示安装成功，再以同样方式按压另一端，确保 eMMC 模块安装成功。

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/radxa-os/install-system/emmc-moudle-board.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

</TabItem>

<TabItem value="板载 eMMC" default={props.tag === "emmc_board"} attributes={{className: props.tag === "emmc_module" && "tab_none"}} >

主板是含有板载 eMMC 的版本，无需安装。

</TabItem>  
</Tabs>

## 安装系统

### FEL 模式说明

FEL 是 Allwinner（全志）芯片中的一种低级启动和刷机模式，主要用于设备无法从常规存储介质启动时的系统恢复或调试。

:::info 参考资料
[FEL 模式](https://linux-sunxi.org/FEL)
:::

### 进入 FEL 模式

需要在主板上电过程中检测到 UBOOT 按键被按下，主板才会进入 FEL 模式。

详细步骤:

① : 按住主板的 UBOOT 按键

② : 使用数据线连接主板的 OTG 接口和 PC

③ : 松开主板的 UBOOT 按键

<Image
  src="/img/common/other-system/fel-image/#sbc_model#-fel-mode.webp"
  baud={props.sbc_model}
  fallback={props.sbc_model}
  width="1200"
/>

### 安装烧录工具

给 eMMC 安装系统需要使用全志平台提供的工具：

PhoenixSuit：适用于 Windows 平台。

LiveSuit：适用于 Linux 平台。

<Tabs queryString="platform">

<TabItem value="Windows">

在 Windows 平台使用 PhoenixSuit 工具。

:::tip
若您使用的是 Windows 系统，需要进入 `Windows 安全中心` → `设备安全性` → `内核隔离` :将里面的选项全部关闭，否则会出现驱动带有感叹号或安装失败的问题。
:::

- 安装驱动

解压下载的 `PhoenixSuit` 压缩包：

① : 进入 `PhoenixSuit` --> `Drivers` --> `AW_Driver` 目录

② : 选择 `AW_Driver` 目录下的 `InstallUSBDrv.exe` 文件

③ : 以管理员身份运行 `InstallUSBDrv.exe` 驱动程序

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/other-system/fel-image/phoenix-driver.webp"
    style={{ width: "80%", maxWidth: "1200px" }}
  />
</div>

驱动安装成功，你可以在设备管理器看到一个新增且被正常识别的 `USB Device` 设备。

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/other-system/fel-image/windows-detect-fel.webp"
    style={{ width: "80%", maxWidth: "1200px" }}
  />
</div>

- 使用 PhoenixSuit 工具

进入 `PhoenixSuit` 目录，运行 `PhoenixSuit.exe` 程序。

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/other-system/fel-image/phoenix-interface-zh.webp"
    style={{ width: "80%", maxWidth: "1200px" }}
  />
</div>

</TabItem>

<TabItem value="Linux">

在 Ubuntu 平台使用 LiveSuit 工具。

- 安装依赖

```bash
sudo apt update
sudo apt install dkms
```

- 添加文件可执行权限
  解压下载的压缩包，进入 LiveSuit 目录，运行下面命令给文件添加可执行权限。

<NewCodeBlock tip="Linux-Host$" type="host">
  ``` sudo chmod +x LiveSuit.run ```
</NewCodeBlock>

- 运行 LiveSuit.run 文件

运行 `LiveSuit.run` 文件安装程序。

<NewCodeBlock tip="Linux-Host$" type="host">
  ``` ./LiveSuit.run ```
</NewCodeBlock>

程序安装成功后，会输出类似以下信息：其中 `user_name` 为当前登录的用户名。

```
========***********LiveSuit installed completely***********===========
LiveSuit  has been installed in /home/user_name/Bin/livesuit
========***********LiveSuit installed completely***********===========
```

- 运行 LiveSuit 工具

进入程序目录，输入下面命令运行 LiveSuit 工具。

<NewCodeBlock tip="Linux-Host$" type="host">

```
sudo ./LiveSuit
```

</NewCodeBlock>

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/other-system/fel-image/livesuit-interface.webp"
    style={{ width: "80%", maxWidth: "1200px" }}
  />
</div>

:::tip
若运行程序提示有关找不到 `libpng12.so.0` 的错误，可以运行以下命令解决。

<NewCodeBlock tip="Linux-Host$" type="host">
  ``` mkdir libpng cd libpng/ wget
  https://ppa.launchpadcontent.net/linuxuprising/libpng12/ubuntu/pool/main/libp/libpng/libpng_1.2.54.orig.tar.xz
  tar -xvf libpng_1.2.54.orig.tar.xz cd libpng-1.2.54 ./configure make sudo make
  install sudo ln -s /usr/local/lib/libpng12.so.0.54.0 /usr/lib/libpng12.so sudo
  ln -s /usr/local/lib/libpng12.so.0.54.0 /usr/lib/libpng12.so.0 ```
</NewCodeBlock>
:::

</TabItem>

</Tabs>

### 烧录系统镜像

根据自己的系统平台打开全志提供的系统镜像烧录工具。

<Tabs queryString="platform">

<TabItem value="Windows">

Linux 平台打开 PhoenixSuit 工具进行系统镜像的烧录。

- 镜像烧录

提前下载系统镜像文件，系统镜像文件需要解压后才可以烧录到 eMMC 中。

① ： 选择 `浏览` 选项，找到系统镜像对应的文件（选择实际解压的系统文件）

② : 选择 `全盘擦除升级` 选项

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/other-system/fel-image/phoenix-install-image-zh.webp"
    style={{ width: "80%", maxWidth: "1200px" }}
  />
</div>

若软件没有自动给主板烧录系统，你可以让主板重新进入 FEL 模式，然后观察软件的烧录进度。

- 烧录完成

当软件显示 `固件烧写成功` 时，说明系统镜像烧录完成，此时可以关闭 PhoenixSuit 工具。

<div style={{textAlign: 'center'}}>
  <img src="/img/common/other-system/fel-image/phoenix-success-zh.webp" style={{width: '80%', maxWidth: '1200px'}} />
</div>
</TabItem>

<TabItem value="Linux">

Linux 平台打开 LiveSuit 工具进行系统镜像的烧录。

- 镜像烧录

提前下载系统镜像文件，系统镜像文件需要解压后才可以烧录到 eMMC 中。

① ： 选择 `Image` 选项，找到系统镜像对应的文件（选择实际解压的系统文件）

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/other-system/fel-image/livesuit-install-image.webp"
    style={{ width: "80%", maxWidth: "1200px" }}
  />
</div>

若软件没有自动给主板烧录系统，你可以让主板重新进入 FEL 模式，然后观察终端输出的信息和软件的进度条。

- 烧录完成

当进度条显示 `100%` 时，说明系统镜像烧录完成，此时可以关闭 LiveSuit 工具。

<div style={{ textAlign: "center" }}>
  <img
    src="/img/common/other-system/fel-image/livesuit-success.webp"
    style={{ width: "80%", maxWidth: "1200px" }}
  />
</div>

</TabItem>

</Tabs>

## 系统信息

您使用我们提供的系统镜像，首次需要使用我们设置的用户名和密码登录系统。

- radxa

用户账号：radxa

用户密码：radxa
