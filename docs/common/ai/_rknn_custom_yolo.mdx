å¾ˆå¤šç”¨æˆ·å¯ä»¥è·‘é€š [RKNN Model Zoo](https://github.com/airockchip/rknn_model_zoo) ä»“åº“é‡Œçš„ YOLO æ¨¡å‹ç¤ºä¾‹ï¼Œä½†åé¦ˆä¸çŸ¥é“å¦‚ä½•è½¬æ¢è‡ªå·±è®­ç»ƒçš„ YOLO ç³»åˆ—æ¨¡å‹ï¼Œåœ¨ [æ¿ç«¯éƒ¨ç½² YOLOv5 ç›®æ ‡æ£€æµ‹](rknn-toolkit-lite2-yolov5) æˆ–è€…åœ¨
[RKNN Model Zoo](https://github.com/airockchip/rknn_model_zoo) ä¸­çš„ YOLO ç³»åˆ—æ¨¡å‹ï¼Œ
ä½¿ç”¨çš„æ¨¡å‹æ˜¯ Rockchip æä¾›ä¸‹è½½çš„ ONNX æ¨¡å‹å’Œ radxa æä¾›çš„é¢„ç¼–è¯‘ rknn æ¨¡å‹ã€‚æ­¤æ–‡æ¡£å°†è®²è¿°å¦‚ä½•ä½¿ç”¨ RKNN ç¼–è¯‘è‡ªè®­ç»ƒçš„ YOLO æ¨¡å‹ï¼Œå¹¶åœ¨æ¿ç«¯ä¸Šè¿›è¡Œæ¨ç†

æ­¤æ–‡æ¡£é€‚ç”¨äºä»¥ä¸‹æ¨¡å‹

- ultralytics-yolov5
- yolov6
- yolov7
- ultralytics-yolov8
- yolov10
- YOLOX
- ultralytics-yolo11
- YOLO-World

:::tip
æ­¤æ–‡æ¡£ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®é›†è®­ç»ƒçš„ yolo11n æ¨¡å‹ä¸ºä¾‹å­ï¼Œæ­¤æ¨¡å‹åº”ç”¨äºå¤©ç©ºè§†è§‰çš„äººç‰©å¤´éƒ¨ä½ç½®æ£€æµ‹ã€‚æœ¬æ•™ç¨‹ä»…é’ˆå¯¹å¦‚ä½•è½¬æ¢è‡ªè®­ç»ƒæ¨¡å‹ï¼Œä¸é’ˆå¯¹è®­ç»ƒæ¨¡å‹æœ¬èº«çš„å‡†ç¡®ç‡ã€‚

æ­¤æ¨¡å‹ç”± radxa ç¤¾åŒºç”¨æˆ· @[sanskarjainba-hub](https://github.com/radxa-docs/docs/issues/1081) æä¾›

è¿™é‡Œå·²çŸ¥æ¡ä»¶ä¸º:

- è‡ªå®šä¹‰æ•°æ®é›†åˆè®­ç»ƒçš„æ¨¡å‹
- æ¨¡å‹ç»“æ„æ˜¯ yolo11n
- æ¨¡å‹ label åªæœ‰ "PERSON"
- å·²æä¾›æµ‹è¯•ç”¨è¾“å…¥æ•°æ®
  :::

## æä¾›çš„æ¨¡å‹ä¸è‡ªè®­ç»ƒæ¨¡å‹ä¸åŒç‚¹

é¦–å…ˆè¦çŸ¥é“ä¸ºä»€ä¹ˆç”¨æˆ·ç¼–è¯‘è‡ªå·±è®­ç»ƒ YOLO æ¨¡å‹ç¼–è¯‘å‡ºé”™ï¼Œä¸ºä»€ä¹ˆé‡åŒ–ç¼–è¯‘åç²¾åº¦é™ä½æˆ–è€…ä¸çŸ¥é“å¦‚ä½•è¿›è¡Œåå¤„ç†ã€‚
åœ¨è¿™ä¹‹å‰éœ€è¦å…ˆçŸ¥é“æä¾›çš„æ¨¡å‹ç»“æ„å’Œè‡ªè®­ç»ƒçš„æ¨¡å‹ç»“æ„æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„åœ°æ–¹ã€‚æˆ‘ä»¬ä½¿ç”¨ Netron è¿›è¡Œå¯¹æ¯” ONNX æ¨¡å‹çš„è¾“å…¥è¾“å‡ºèŠ‚ç‚¹ã€‚

<div style={{ textAlign: "center" }}>
  <img src="/img/rock5b/yolo11_rk_st.webp" style={{ width: "80%" }} />
  RKNN Model Zoo ä¸‹è½½çš„ yolo11n æ¨¡å‹è¾“å‡ºç»“æ„
</div>

<div style={{ textAlign: "center" }}>
  <img src="/img/rock5b/yolo11_custom_st.webp" style={{ width: "80%" }} />
  è‡ªè®­ç»ƒçš„ yolo11n æ¨¡å‹è¾“å‡ºç»“æ„
</div>

å¯¹æ¯”å¯ä»¥çœ‹åˆ°ï¼Œä¸¤è€…çš„æ¨¡å‹è¾“å‡ºèŠ‚ç‚¹å­˜åœ¨å·®å¼‚ï¼ŒRKNN Model Zoo ä¸‹è½½çš„ yolo11 è¾“å‡ºä¸º 9 è¾“å‡ºå¤´ï¼Œè‡ªè®­ç»ƒæ¨¡å‹çš„è¾“å‡ºä¸º 1 è¾“å‡ºå¤´ã€‚

### æ¨¡å‹å·®å¼‚ç‚¹

- ä¿®æ”¹è¾“å‡ºç»“æ„, ç§»é™¤åå¤„ç†ç»“æ„. (åå¤„ç†ç»“æœå¯¹äºé‡åŒ–ä¸å‹å¥½)

- dfl ç»“æ„åœ¨ NPU å¤„ç†ä¸Šæ€§èƒ½ä¸ä½³ï¼Œç§»è‡³æ¨¡å‹å¤–éƒ¨çš„åå¤„ç†é˜¶æ®µï¼Œæ­¤æ“ä½œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯æå‡æ¨ç†æ€§èƒ½ã€‚

- æ¨¡å‹è¾“å‡ºåˆ†æ”¯æ–°å¢ç½®ä¿¡åº¦çš„æ€»å’Œï¼Œç”¨äºåå¤„ç†é˜¶æ®µåŠ é€Ÿé˜ˆå€¼ç­›é€‰ã€‚

ä»¥ä¸Šç§»é™¤çš„æ“ä½œ, å‡éœ€è¦åœ¨å¤–éƒ¨ä½¿ç”¨ CPU è¿›è¡Œç›¸åº”çš„å¤„ç†. (å¯¹åº”çš„åå¤„ç†ä»£ç å¯ä»¥åœ¨ RKNN_Model_Zoo ä¸­æ‰¾åˆ°)

## æ¨¡å‹è½¬æ¢

è¿™é‡Œæ¨¡å‹è½¬æ¢æœ‰ä¸¤ä¸ªæ€è·¯

- FP16 æµ®ç‚¹è½¬æ¢/è‡ªåŠ¨æ··åˆé‡åŒ–ï¼Œä¿æŒåŸé¡¹ç›®åå¤„ç†ä»£ç  ï¼ˆæœ€ç®€å•ï¼Œä¿æŒåŸé¡¹ç›®ä»£ç , ä½†æ€§èƒ½æå‡æœ‰é™ï¼‰
- INT8 é‡åŒ–è½¬æ¢ï¼Œä¿®æ”¹æ¨¡å‹åå¤„ç†ç»“æ„ï¼Œä½¿ç”¨ RKNN Model Zoo åå¤„ç†ä»£ç  ï¼ˆæœ€ä½³æ€§èƒ½ï¼ŒINT8 é‡åŒ–å¹¶ä¼˜åŒ–åå¤„ç†ï¼‰

### æ¨¡å‹å‡†å¤‡

è¿™é‡Œå‡†å¤‡ç”¨æˆ·è‡ªå·±è®­ç»ƒçš„ pytorch æ ¼å¼çš„æ¨¡å‹ï¼Œè¿™é‡Œä»¥ best.pt å’Œæ¨¡å‹æ¨ç†æµ‹è¯•çš„å›¾ç‰‡ä¸ºä¾‹å­ã€‚

<div style={{ textAlign: "center" }}>
  <img src="/img/rock5b/frame_00304.webp" style={{ width: "80%" }} />
  æµ‹è¯•å›¾ç‰‡
</div>

### ä½¿ç”¨ CPU æ¨ç† pytorch æ¨¡å‹

è¿™é‡Œå…ˆä½¿ç”¨ CPU åœ¨æ¿ç«¯æ¨ç†åŸå§‹ pytorch æ¨¡å‹æ”¶é›†æ¨ç†é€Ÿåº¦å’Œç²¾åº¦æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨ `ultralytics` å·¥å…·è¿›è¡ŒéªŒè¯ (é ultralytics çš„ yolo æ¨¡å‹è¯·è‡ªè¡ŒéªŒè¯)

<NewCodeBlock tip="Device" type="device">

```bash
pip3 install -U ultralytics
yolo predict model=best.pt source="../test_img/frame_00304.jpg"
```

</NewCodeBlock>

```bash
(.venv) rock@rock-5b-plus:~/ssd/rknn/rknn_model_zoo/examples/yolo11/model$ yolo predict model=best.pt source="../test_img/frame_00304.jpg"
Ultralytics 8.3.231 ğŸš€ Python-3.11.2 torch-2.9.1+cpu CPU (aarch64)
YOLO11n summary (fused): 100 layers, 2,582,347 parameters, 0 gradients, 6.3 GFLOPs

image 1/1 /mnt/ssd/rknn/rknn_model_zoo/examples/yolo11/model/../test_img/frame_00304.jpg: 384x640 3 PERSONs, 268.8ms
Speed: 4.1ms preprocess, 268.8ms inference, 1.9ms postprocess per image at shape (1, 3, 384, 640)
Results saved to /mnt/ssd/rknn/rknn_model_zoo/examples/yolo11/model/runs/detect/predict3
ğŸ’¡ Learn more at https://docs.ultralytics.com/modes/predict
```

è¿™é‡Œæ”¶é›†åˆ° pytorch æ¨¡å‹æ¨ç†é€Ÿåº¦ä¸º **268.8ms**

<div style={{ textAlign: "center" }}>
  <img src="/img/rock5b/frame_00304_cpu.webp" style={{ width: "80%" }} />
  best.pt æ¨ç†ç»“æœ
</div>

### è½¬æ¢ FP16 æµ®ç‚¹æ¨¡å‹

å¦‚æœç”¨æˆ·ä¸å¸Œæœ›ä¿®æ”¹ä»»ä½•é¡¹ç›®ä»£ç ï¼Œä»…å°†æ¨¡å‹æ¨ç†è¿ç§»åˆ° NPU ä¸Šï¼Œå¯ä»¥ä½¿ç”¨å…¨ FP16 æ¨¡å‹è½¬æ¢ã€‚

#### ä½¿ç”¨ ultralytics è½¬æ¢

å¦‚æœæ˜¯ ultralytics å‘å¸ƒçš„æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨ Ultralytics è¿›è¡Œæ¨¡å‹è½¬æ¢, è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ [RKNN Ultralytics YOLOv11](./rknn-ultralytics)

<NewCodeBlock tip="X86 Linux PC" type="PC">

```bash
yolo export model=best.pt format=rknn name=rk3588
```

</NewCodeBlock>

ç»“æœä¿å­˜åœ¨ ./best_rknn_model

#### ä½¿ç”¨ ultralytics æ¨ç†

å°†è½¬æ¢æˆåŠŸçš„ best_rknn_model æ¨¡å‹ç›®å½•å¤åˆ¶åˆ°æ¿ç«¯ï¼Œä½¿ç”¨ ultralytics å·¥å…·ç›´æ¥ä½¿ç”¨ NPU æ¨ç†æµ®ç‚¹æ¨¡å‹

<NewCodeBlock tip="Device" type="device">

```bash
yolo predict model='./best_rknn_model' source='../test_img/frame_00304.jpg'
```

</NewCodeBlock>

```bash
(.venv) rock@rock-5b-plus:~/ssd/rknn/rknn_model_zoo/examples/yolo11/model$ yolo predict model='./best_rknn_model' source='../test_img/frame_00304.jpg'
WARNING âš ï¸ Unable to automatically guess model task, assuming 'task=detect'. Explicitly define task for your model, i.e. 'task=detect', 'segment', 'classify','pose' or 'obb'.
Ultralytics 8.3.231 ğŸš€ Python-3.11.2 torch-2.9.1+cpu CPU (aarch64)
Loading ./best_rknn_model for RKNN inference...
W rknn-toolkit-lite2 version: 2.3.2
I RKNN: [08:27:32.098] RKNN Runtime Information, librknnrt version: 2.3.2 (429f97ae6b@2025-04-09T09:09:27)
I RKNN: [08:27:32.098] RKNN Driver Information, version: 0.9.8
I RKNN: [08:27:32.098] RKNN Model Information, version: 6, toolkit version: 2.3.0(compiler version: 2.3.0 (c949ad889d@2024-11-07T11:39:30)), target: RKNPU v2, target platform: rk3588, framework name: ONNX, framework layout: NCHW, model inference type: static_shape
W RKNN: [08:27:32.122] query RKNN_QUERY_INPUT_DYNAMIC_RANGE error, rknn model is static shape type, please export rknn with dynamic_shapes
W Query dynamic range failed. Ret code: RKNN_ERR_MODEL_INVALID. (If it is a static shape RKNN model, please ignore the above warning message.)

image 1/1 /mnt/ssd/rknn/rknn_model_zoo/examples/yolo11/model/../test_img/frame_00304.jpg: 640x640 3 PERSONs, 64.3ms
Speed: 6.6ms preprocess, 64.3ms inference, 2.7ms postprocess per image at shape (1, 3, 640, 640)
Results saved to /mnt/ssd/rknn/rknn_model_zoo/examples/yolo11/model/runs/detect/predict4
ğŸ’¡ Learn more at https://docs.ultralytics.com/modes/predict
```

è¿™é‡Œæ”¶é›†åˆ°æµ®ç‚¹ RKNN æ¨¡å‹æ¨ç†é€Ÿåº¦ä¸º **64.3ms**

<div style={{ textAlign: "center" }}>
  <img src="/img/rock5b/frame_00304_fp_rknn.webp" style={{ width: "80%" }} />
  best-rk3588-fp.rknn æ¨ç†ç»“æœ
</div>

#### ä½¿ç”¨è„šæœ¬è½¬æ¢

å¦‚æœé ultralytics çš„ yolo æ¨¡å‹ï¼Œrknn_model_zoo/examples ä¸‹å¯¹åº”çš„ yolo æ¨¡å‹ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ª `python/convert.py` è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨æ­¤è„šæœ¬å¯¹ ONNX æ¨¡å‹ç›´æ¥è½¬æ¢æˆ fp æ ¼å¼çš„ RKNN æ¨¡å‹
å°† pytorch æ¨¡å‹å¯¼å‡ºä¸º ONNX æ¨¡å‹åä½¿ç”¨ convert.py è„šæœ¬æŒ‡å®šé‡åŒ–ç±»å‹ä¸º `fp` å³å¯

å…·ä½“è¯·å‚è€ƒ [æ¿ç«¯éƒ¨ç½² YOLOv5 ç›®æ ‡æ£€æµ‹](rknn-toolkit-lite2-yolov5#pcç«¯æ¨¡å‹è½¬æ¢)

### è½¬æ¢ INT8 é‡åŒ–æ¨¡å‹

å› ä¸º yolo æ¨¡å‹çš„åå¤„ç†ç»“æœå¯¹äºé‡åŒ–ä¸å‹å¥½ï¼Œ ä¸”éƒ¨åˆ†ç»“æ„åœ¨ NPU å¤„ç†ä¸Šæ€§èƒ½ä¸ä½³ï¼Œ è¦å°†æ¨¡å‹é‡åŒ–ä¸º INT8 ç±»å‹éœ€è¦å¯¹æ¨¡å‹åå¤„ç†ç»“æ„ä½œä¿®æ”¹ï¼Œ
å°†è¾“å‡ºç»“æ„è¿›è¡Œä¿®æ”¹ç„¶åç»Ÿä¸€ä½¿ç”¨ RKNN_Model_Zoo ä¸­åå¤„ç†ä»£ç ã€‚

ä¿®æ”¹æ¨¡å‹ç»“æ„ rockchip æä¾›äº†é’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„ yolo æ¨¡å‹ç»“æ„ä¿®æ”¹ä»“åº“ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿç®€å•

| æ¨¡å‹       | ä»“åº“                                             | README                                                                     |
| ---------- | ------------------------------------------------ | -------------------------------------------------------------------------- |
| yolov5     | https://github.com/airockchip/yolov5             | https://github.com/airockchip/yolov5/blob/master/README_rkopt.md           |
| yolov6     | https://github.com/airockchip/YOLOv6             | https://github.com/airockchip/YOLOv6/blob/main/deploy/RKNN/RKOPT_README.md |
| yolov7     | https://github.com/airockchip/yolov7             | https://github.com/airockchip/yolov7/blob/main/README_rkopt.md             |
| yolov8     | https://github.com/airockchip/ultralytics_yolov8 | https://github.com/airockchip/ultralytics_yolov8/blob/main/RKOPT_README.md |
| yolov10    | https://github.com/airockchip/yolov10            | https://github.com/airockchip/yolov10/blob/main/RKNN_README_EN.md          |
| YOLOX      | https://github.com/airockchip/YOLOX              | https://github.com/airockchip/YOLOX/blob/main/README_rkopt.md              |
| yolo11     | https://github.com/airockchip/ultralytics_yolo11 | https://github.com/airockchip/ultralytics_yolo11/blob/main/RKOPT_README.md |
| YOLO-World | https://github.com/airockchip/YOLO-World         | https://github.com/airockchip/YOLO-World/blob/master/RKNN_README_EN.md     |

è¿™é‡Œæ¥ç€æ˜¯ä½¿ç”¨è‡ªè®­ç»ƒçš„ yolo11 ä¸ºä¾‹å­ï¼Œå°†è‡ªè®­ç»ƒçš„ best.pt è½¬æ¢ä¸º INT8 é‡åŒ–çš„ RKNN æ¨¡å‹

#### ä¿®æ”¹æ¨¡å‹ç»“æ„

ä»è¡¨æ ¼ä¸­å…‹éš†å¯¹åº”æ¨¡å‹çš„ä»“åº“

<NewCodeBlock tip="X86 Linux PC" type="PC">

```bash
git clone https://github.com/airockchip/ultralytics_yolo11.git && cd ultralytics_yolo11
```

</NewCodeBlock>

åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

<NewCodeBlock tip="X86 Linux PC" type="PC">

```bash
python3 -m venv .venv
source .venv/bin/activate
pip3 install ultralytics onnx
```

</NewCodeBlock>

æŒ‰ç…§è¡¨æ ¼ä¸­å¯¹åº”æ¨¡å‹çš„ README å¯¹æ¨¡å‹ç»“æ„è¿›è¡Œä¿®æ”¹å¹¶å¯¼å‡º ONNX, è¿™é‡Œæ˜¯ yolo11 çš„ä¾‹å­

ä¿®æ”¹ `default.yaml` é‡Œçš„æ¨¡å‹è·¯å¾„

<NewCodeBlock tip="X86 Linux PC" type="PC">

```bash
vim ./ultralytics/cfg/default.yaml
```

</NewCodeBlock>

<div style={{ textAlign: "center" }}>
  <img src="/img/rock5b/yolo11_yaml.webp" style={{ width: "100%" }} />
  æ¨¡å‹è·¯å¾„ä¿®æ”¹ä½ç½®
</div>

ä½¿ç”¨è„šæœ¬ä¿®æ”¹ç»“æ„å¹¶å¯¼å‡º ONNX æ¨¡å‹

<NewCodeBlock tip="X86 Linux PC" type="PC">

```bash
export PYTHONPATH=./
python3 ./ultralytics/engine/exporter.py
```

</NewCodeBlock>

```bash
(.venv) (base) zifeng@vms-max:~/Job/git_clone/rknn_yolo/ultralytics_yolo11$ python ./ultralytics/engine/exporter.py
Ultralytics 8.3.9 ğŸš€ Python-3.8.2 torch-2.4.1+cu121 CPU (Intel Core(TM) i9-14900KF)
YOLO11n summary (fused): 238 layers, 2,582,347 parameters, 0 gradients, 6.3 GFLOPs

PyTorch: starting from '/home/zifeng/Job/sda1/customer/sanskarjainba-hub/best.pt' with input shape (16, 3, 640, 640) BCHW and output shape(s) ((16, 64, 80, 80), (16, 1, 80, 80), (16, 1, 80, 80), (16, 64, 40, 40), (16, 1, 40, 40), (16, 1, 40, 40), (16, 64, 20, 20), (16, 1, 20, 20), (16, 1, 20, 20)) (5.2 MB)

RKNN: starting export with torch 2.4.1+cu121...

RKNN: feed /home/zifeng/Job/sda1/customer/sanskarjainba-hub/best.onnx to RKNN-Toolkit or RKNN-Toolkit2 to generate RKNN model.
Refer https://github.com/airockchip/rknn_model_zoo/tree/main/examples/
RKNN: export success âœ… 0.4s, saved as '/home/zifeng/Job/sda1/customer/sanskarjainba-hub/best.onnx' (9.9 MB)

Export complete (1.5s)
Results saved to /mnt/sda1/customer/sanskarjainba-hub
Predict:         yolo predict task=detect model=/home/zifeng/Job/sda1/customer/sanskarjainba-hub/best.onnx imgsz=640
Validate:        yolo val task=detect model=/home/zifeng/Job/sda1/customer/sanskarjainba-hub/best.onnx imgsz=640 data=E:\Sanskar_Jain\APC\apc_lappy\OAK\Final_dataset\data.yaml
Visualize:       https://netron.app
```

<div style={{ textAlign: "center" }}>
  <img
    src="/img/rock5b/yolo11_custom_change_st.webp"
    style={{ width: "80%" }}
  />
  ä¿®æ”¹åçš„æ¨¡å‹ç»“æ„
</div>

#### è½¬æ¢ä¸º INT8 RKNN æ¨¡å‹

ä½¿ç”¨ `rknn_model_zoo/examples/yolo11/python/convert.py` å¯¹æ¨¡å‹è¿›è¡Œé‡åŒ–ç¼–è¯‘

<NewCodeBlock tip="X86 Linux PC" type="PC">

```bash
python3 convert.py best.onnx rk3588 i8 best.rknn
```

</NewCodeBlock>

```bash
(rknn) zifeng@vms-max:~/Job/git_clone/rknn_model_zoo/examples/yolo11/python$ python3 convert.py /home/zifeng/Job/sda1/customer/sanskarjainba-hub/best.onnx rk3588 i8 /home/zifeng/Job/sda1/customer/sanskarjainba-hub/best.rknn
I rknn-toolkit2 version: 2.3.2
--> Config model
done
--> Loading model
I Loading : 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 174/174 [00:00<00:00, 114300.53it/s]
done
--> Building model
I OpFusing 0: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 100/100 [00:00<00:00, 1704.81it/s]
I OpFusing 1 : 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 100/100 [00:00<00:00, 721.25it/s]
I OpFusing 0 : 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 100/100 [00:00<00:00, 379.96it/s]
I OpFusing 1 : 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 100/100 [00:00<00:00, 363.89it/s]
I OpFusing 2 : 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 100/100 [00:00<00:00, 205.95it/s]
W build: found outlier value, this may affect quantization accuracy
                        const name                          abs_mean    abs_std     outlier value
                        model.0.conv.weight                 2.91        2.62        -16.472
                        model.23.cv3.0.0.0.conv.weight      0.33        0.62        -10.566
I GraphPreparing : 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 220/220 [00:00<00:00, 29180.54it/s]
I Quantizating : 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 220/220 [00:03<00:00, 70.28it/s]
W build: The default input dtype of 'images' is changed from 'float32' to 'int8' in rknn model for performance!
                       Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of '462' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of 'onnx::ReduceSum_476' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of '480' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of '487' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of 'onnx::ReduceSum_501' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of '505' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of '512' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of 'onnx::ReduceSum_526' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
W build: The default output dtype of '530' is changed from 'float32' to 'int8' in rknn model for performance!
                      Please take care of this change when deploy rknn model with Runtime API!
I rknn building ...
I rknn building done.
done
--> Export rknn model
done
```

#### ä¿®æ”¹ RKNN_Model_Zoo ä¸­çš„ç¤ºä¾‹ä»£ç 

- ä¿®æ”¹ `rknn_model_zoo/py_utils/rknn_executor.py` ä»£ç ï¼Œ**è¯·å¤‡ä»½åŸç‰ˆä»£ç **

  è¯·æ ¹æ® [æ¿ç«¯å®‰è£… RKNN Model Zoo](./rknn-model-zoo) é…ç½® RKNN Model Zoo ä»£ç ä»“åº“

  <NewCodeBlock tip="Python Code" type="device">

  ```python
  from rknnlite.api import RKNNLite as RKNN

  class RKNN_model_container():
      def __init__(self, model_path, target=None, device_id=None) -> None:
          rknn = RKNN()
          rknn.load_rknn(model_path)
          ret = rknn.init_runtime()
          self.rknn = rknn

      def run(self, inputs):
          if self.rknn is None:
              print("ERROR: rknn has been released")
              return []

          if isinstance(inputs, list) or isinstance(inputs, tuple):
              pass
          else:
              inputs = [inputs]

          result = self.rknn.inference(inputs=inputs)

          return result

      def release(self):
          self.rknn.release()
          self.rknn = None
  ```

  </NewCodeBlock>

- ä¿®æ”¹ `rknn_model_zoo/examples/yolo11/python/yolo11.py` 262 è¡Œçš„ä»£ç , **è¯·å¤‡ä»½åŸç‰ˆä»£ç **

  <NewCodeBlock tip="Python Code" type="device">

  ```python
  262 outputs = model.run([np.expand_dims(input_data, 0)])
  ```

  </NewCodeBlock>

- ä¿®æ”¹ `CLASSES` ä¸ `coco_id_list`

  æ ¹æ®è®­ç»ƒæ¨¡å‹çš„ç±»åˆ«è¿›è¡Œä¿®æ”¹ä»£ç ä¸­ `CLASSES` çš„å˜é‡

  <NewCodeBlock tip="Python Code" type="device">

  ```python
  CLASSES = ["person"]
  ```

  </NewCodeBlock>

#### ä½¿ç”¨ ONNX æ¨¡å‹è¿›è¡Œæ¨ç†

å°†ä¿®æ”¹è¿‡çš„ ONNX æ¨¡å‹å¤åˆ¶åˆ°æ¿ç«¯ï¼Œä½¿ç”¨ RKNN Model Zoo çš„ä»£ç è¿›è¡Œæ¨ç†ï¼ŒéªŒè¯æ¨¡å‹ç»“æ„ä¿®æ”¹åæ˜¯å¦å‡ºç°é—®é¢˜

<NewCodeBlock tip="Device" type="device">

```bash
cd rknn_model_zoo/examples/yolo11/python
python3 yolo11.py --model_path ../model/best.onnx --img_folder ../test_img/ --img_save
```

</NewCodeBlock>

```bash
(.venv) rock@rock-5b-plus:~/ssd/rknn/rknn_model_zoo/examples/yolo11/python$ python3 yolo11.py --model_path ../model/best.onnx --img_folder ../test_img/ --img_save
2025-11-25 10:27:21.165203468 [W:onnxruntime:Default, device_discovery.cc:164 DiscoverDevicesForPlatform] GPU device discovery failed: device_discovery.cc:89 ReadFileContents Failed to open file: "/sys/class/drm/card1/device/vendor"
/mnt/ssd/rknn/rknn_model_zoo/py_utils/onnx_executor.py:12: FutureWarning: In the future `np.bool` will be defined as the corresponding NumPy scalar.
  if getattr(np, 'bool', False):
Model-../model/best.onnx is onnx model, starting val
WARNING: reshape inputdata-0: from (1, 3, 640, 640) to [1, 3, 640, 640]
112.08ms

IMG: frame_00304.jpg
PERSON @ (534 389 739 548) 0.729
PERSON @ (535 244 741 390) 0.336
PERSON @ (205 86 350 162) 0.256
Detection result save to ./result/frame_00304.jpg
```

å¯ä»¥çœ‹åˆ°ä¿®æ”¹ç»“æ„åçš„ ONNX æ¨¡å‹ CPU æ¨ç†æ—¶é—´ä¸º **112.08 ms**ï¼Œä¸”ç»“æœæ­£ç¡®

<div style={{ textAlign: "center" }}>
  <img
    src="/img/rock5b/yolo11_custom_onnx_result.webp"
    style={{ width: "80%" }}
  />
  best.onnx æ¨ç†ç»“æœ
</div>

#### ä½¿ç”¨ INT8 RKNN æ¨¡å‹è¿›è¡Œæ¨ç†

<NewCodeBlock tip="Device" type="device">

```bash
cd rknn_model_zoo/examples/yolo11/python
python3 yolo11.py --model_path ./best.rknn --img_folder ./test_img --img_save
```

</NewCodeBlock>

```bash
(.venv) rock@rock-5b-plus:~/ssd/rknn/rknn_model_zoo/examples/yolo11/python$ python3 yolo11.py --model_path ../model/best.onnx --img_folder ../test_img/ --img_save
2025-11-25 10:27:21.165203468 [W:onnxruntime:Default, device_discovery.cc:164 DiscoverDevicesForPlatform] GPU device discovery failed: device_discovery.cc:89 ReadFileContents Failed to open file: "/sys/class/drm/card1/device/vendor"
/mnt/ssd/rknn/rknn_model_zoo/py_utils/onnx_executor.py:12: FutureWarning: In the future `np.bool` will be defined as the corresponding NumPy scalar.
  if getattr(np, 'bool', False):
Model-../model/best.onnx is onnx model, starting val
WARNING: reshape inputdata-0: from (1, 3, 640, 640) to [1, 3, 640, 640]
18.74ms
IMG: frame_00304.jpg
PERSON @ (534 388 737 551) 0.671
PERSON @ (206 85 349 160) 0.341
PERSON @ (534 242 740 400) 0.327
Detection result save to ./result/frame_00304.jpg
```

å¯ä»¥çœ‹åˆ° INT8 é‡åŒ–çš„ RKNN æ¨¡å‹ NPU æ¨ç†æ—¶é—´ä¸º **18.74 ms**, ä¸”ç»“æœä¸ ONNX æ¨¡å‹ä¸€è‡´

<div style={{ textAlign: "center" }}>
  <img
    src="/img/rock5b/yolo11_custom_rknn_result.webp"
    style={{ width: "80%" }}
  />
  best.rknn æ¨ç†ç»“æœ
</div>

## æ¨ç†æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹           | ç±»å‹ | æ¨ç†åç«¯ | æ—¶é—´      |
| -------------- | ---- | -------- | --------- |
| best.pt        | fp32 | CPU      | 268.8 ms  |
| best.onnx      | fp32 | CPU      | 112.08 ms |
| best_fp.rknn   | fp16 | NPU      | 64.3 ms   |
| best_int8.rknn | INT8 | NPU      | 18.74 ms  |

ä»è¡¨æ ¼æ•°æ®å¯ä»¥å¾—åˆ°çš„ç»“è®ºï¼Œè‡ªè®­ç»ƒçš„ yolo11n æ¨¡å‹åœ¨ ROCK 5B+ ä¸Šçš„æ¨ç†æ€§èƒ½ä» 268.8ms ç§»æ¤åˆ° NPU åé€Ÿåº¦æå‡åˆ° 18.74msï¼Œ
æ€§èƒ½æå‡ 14 å€, ä¸”è¯†åˆ«ç²¾åº¦ä¿æŒä¸€è‡´ã€‚
