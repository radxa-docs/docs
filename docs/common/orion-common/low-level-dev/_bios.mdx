## 使用前提

您需要提前准备以下硬件设备：

<Tabs queryString="mode">

<TabItem value="有屏模式">

- 主板：{props.board}
- 供电：{props.power}
- BIOS 更新介质：U 盘
- 显示设备：HDMI / DP 数据线和显示器
- 输入设备：键盘和鼠标（用于图形界面操作）

</TabItem>

<TabItem value="无屏模式">

- 主板：{props.board}
- 供电：{props.power}
- BIOS 更新介质：U 盘
- 输入设备：键盘和鼠标（用于串口操作）
- 调试工具：USB 转 TTL 串口线

</TabItem>

</Tabs>

<Tabs queryString="system boot">
<TabItem value="星睿 O6" default={props.tag === "o6"} attributes={{className: props.tag === "o6n" && "tab_none"}} >

:::tip 推荐配件

- [瑞莎 PD 65W 电源适配器（推荐使用）](https://radxa.com/products/accessories/power-pd-65w)
- 标准 20V Type-C 电源适配器，建议电流 3A 及以上

:::

</TabItem>

<TabItem value="星睿 O6N" default={props.tag === "o6n"} attributes={{className: props.tag === "o6" && "tab_none"}} >

:::tip 推荐配件

- [瑞莎 DC 36W 电源适配器 (推荐使用)](https://radxa.com/products/accessories/power-dc12-36w)
- [瑞莎 DC 60W 电源适配器 (推荐使用)](https://radxa.com/products/accessories/power-dc12-60w)
- 标准 12V DC5525 电源适配器，建议电流 3A 及以上

:::

</TabItem>  
</Tabs>

## 制作 BIOS 更新盘

### 格式化 U 盘

将 U 盘格式化成 FAT32 格式，其它格式的 U 盘可能无法正常访问 U 盘和更新 BIOS 固件。

### 制作 BIOS 更新盘

访问 <a href={props?.download_page ?? '../download.md'}>资源汇总下载</a> 页面，下载 BIOS 固件；将下载的 BIOS 固件内容复制到 U 盘的根目录下。

BIOS 固件内容如下：

```
BuildOptions
BurnImage.efi
cix_flash_all.bin
cix_flash_ota.bin
EnrollFromDefaultKeysApp.efi
FlashUpdate.efi
Shell.efi
startup.nsh
VariableInfo.efi
```

## 更新 BIOS 固件

### 硬件连接

<Tabs queryString="mode">

<TabItem value="有屏模式">

取下主板上可启动系统的介质（如 U 盘、NVMe 固态硬盘等），避免直接启动系统。

1. 将制作好的 BIOS 更新盘插入主板的 USB 接口
2. 使用 HDMI / DP 数据线连接显示器和主板
3. 连接 USB 键盘到主板
4. 使用电源适配器给主板供电

</TabItem>

<TabItem value="无屏模式">

取下主板上可启动系统的介质（如 U 盘、NVMe 固态硬盘等），避免直接启动系统。

1. 将制作好的 BIOS 更新盘插入主板的 USB 接口
2. 使用 USB 转 TTL 串口线连接主板的调试串口
3. 使用电源适配器给主板供电

:::tip 调试串口

USB 转 TTL 串口线的连接方式可以参考 <a href={props?.serial_login ?? '../system-use/uart'}>串口登录</a> 教程。

注意：若使用串口线无法输入和控制，建议尝试更换 CH34x 芯片的串口线。

:::

</TabItem>

</Tabs>

### 进入 BIOS 界面

:::tip BIOS 界面

系统检测到没有可启动系统介质时，系统会自动进入 BIOS 界面。

:::

<Tabs queryString="mode">

<TabItem value="有屏模式">

启动主板后，显示器出现 Radxa Logo 和进度条时，短按键盘的“Esc”按键进入 `BIOS` 界面。

<div style={{ textAlign: "center" }}>
  Radxa Logo 界面
  <img
    src="/img/orion/o6n/orion-o6n-boot-logo.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

</TabItem>

<TabItem value="无屏模式">

```
Tianocore/EDK2 firmware version 1.0.0-2
Press ESCAPE for boot options
```

</TabItem>

</Tabs>

<div style={{ textAlign: "center" }}>
  BIOS 界面
  <img
    src="/img/orion/o6n/orion-o6n-bios.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

### 更新 BIOS 固件

在 BIOS 界面依次选择 `Boot Manager` -> `UEFI Shell` 选项

<div style={{ textAlign: "center" }}>
  Boot Manager 界面
  <img
    src="/img/orion/o6n/orion-o6n-boot-manager.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

进入 UEFI Shell 界面后，按 `ESC` 键取消自动更新，手动进入指定磁盘更新 BIOS 固件。

<div style={{ textAlign: "center" }}>
  UEFI Shell 界面
  <img
    src="/img/orion/o6n/orion-o6n-uefi-shell.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

:::danger

更新 BIOS 固件，请确保整个过程保持电源的稳定，避免电源断电导致更新失败，以至于主板无法启动系统。

:::

1. 进入 BIOS 文件夹

UEFI Shell 界面的 Mapping table 会显示系统检测到的磁盘信息，我们可以使用 `ls` 命令查看查看磁盘中的文件，从而确定 BIOS 更新盘对应的磁盘；

如图所示，BIOS 启动盘对应的磁盘信息为 `FS2`，则输入 `FS2:` 进入 BIOS 更新盘。

:::tip BIOS 更新盘

若只接一个磁盘，BIOS 更新盘对应的磁盘信息为 `FS0`。

:::

<div style={{ textAlign: "center" }}>
  <img
    src="/img/orion/o6n/orion-o6n-uefi-shell-disk.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

2. 更新 BIOS 固件

我们可以输入 `startup.nsh` 命令并按 `Enter` 键更新 BIOS 固件。

<NewCodeBlock tip="radxa@UEFI-Shell$" type="device">

```
startup.nsh
```

</NewCodeBlock>

<div style={{ textAlign: "center" }}>
  <img
    src="/img/orion/o6n/orion-o6n-bios-update.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

3. 重启系统

更新完成后，重新插拔电源适配器启动系统！

## 使用编程器刷写 BIOS 固件（仅在无法启动系统时使用）

对于需要从损坏的 BIOS 中恢复或偏好直接硬件访问的高级用户，可以使用 Serial Flash 编程器（如 CH341A）将 BIOS 固件（cix_flash_all.bin）直接刷写到 SPI NOR Flash 芯片中。此方法完全绕过操作系统，即使在设备无法启动的情况下也能工作。

### 准备工作

1. 准备硬件

- 编程器：推荐使用 CH341A / CH341B 编程器
- 1.8V 转换器
- SOP8 烧录夹
- linux 系统的电脑

2. 下载 BIOS 固件

访问 <a href={props?.download_page ?? '../download.md'}>资源汇总下载</a> 页面，下载 BIOS 固件。
从 radxa-dl 网站上下载的固件是 zip 格式，需要进行两次解压：

<NewCodeBlock tip="user@linux$" type="host">

```
unzip orion-o6-bios-v1.x.x.zip # orion o6n 的 bios 名称与之类似
cd orion-o6-bios-v1.x.x # 进入解压后的目录
gzip -d cix_flash_all.bin.gz
```

</NewCodeBlock>

3. 安装 flashrom 工具

<NewCodeBlock tip="user@linux$" type="host">

```
sudo apt-get install flashrom
```

</NewCodeBlock>

### 组装烧录夹

1. 将 CH341A/B 编程器设置为刷机模式
   将编程器的跳线帽设置为刷机模式，具体位置请参考编程器说明书。

   <div style={{ textAlign: "center" }}>
     <img
       src="/img/orion/o6/bios/orion-o6-ch341-pin.webp"
       style={{ width: "100%", maxWidth: "1200px" }}
     />
   </div>

2. 将 1.8V 转换器放在 CH341A/B 编程器的烧录夹上并锁定压杠

<div style={{ textAlign: "center" }}>
  <img
    src="/img/orion/o6/bios/orion-o6-ch341-adapter-clamp.webp"
    style={{ width: "100%", maxWidth: "1200px" }}
  />
</div>

3. 将 SOP8 烧录夹放在 1.8V 转换器的脚端并锁定压杠

   <div style={{ textAlign: "center" }}>
     <img
       src="/img/orion/o6/bios/orion-o6-adapter-sop8-clamp-lock.webp"
       style={{ width: "100%", maxWidth: "1200px" }}
     />
   </div>

4. 使用夹具夹住 Flash ROM 芯片

<Tabs queryString="type">
  <TabItem
    value="星睿 O6"
    default={props.tag === "o6"}
    attributes={{ className: props.tag === "o6n" && "tab_none" }}
  >
    将烧录夹夹住主板上的 Flash ROM
    芯片确保夹具的引脚与芯片的引脚对应正确，红色的线为 SOP8 的 1
    号引脚，和芯片上圆形点标注的引脚对应。
    <div style={{ textAlign: "center" }}>
      <img
        src="/img/orion/o6/bios/orion-o6-ch341-eeprom-clamp.webp"
        style={{ width: "100%", maxWidth: "1200px" }}
      />
    </div>
  </TabItem>
  <TabItem
    value="星睿 O6N"
    default={props.tag === "o6n"}
    attributes={{ className: props.tag === "o6" && "tab_none" }}
  >
    将烧录夹夹住取下来的 Flash ROM
    芯片，确保夹具的引脚与芯片的引脚对应正确，红色的线为 SOP8 的 1
    号引脚，和芯片上圆形点标注的引脚对应。 拆卸安装 BIOS
    芯片的步骤请参考下方的“拆卸 SPI Flash 芯片”和“安装 SPI Flash 芯片”章节。
    <div style={{ textAlign: "center" }}>
      <img
        src="/img/orion/o6/bios/orion-o6n-ch341-eeprom-clamp.webp"
        style={{ width: "100%", maxWidth: "1200px" }}
      />
    </div>
  </TabItem>
</Tabs>

### 刷写 BIOS 固件

1. 插入编程器并启动电脑

将组装好的编程器插入 linux 系统的电脑 USB 接口。

2. 查看编程器识别情况

<NewCodeBlock tip="user@linux$" type="host">

```
sudo flashrom -L | grep ch341
```

</NewCodeBlock>

如果显示类似如下信息，表示编程器识别成功：

```
Supported USB devices for the ch34la_spi programmer
```

3. 查看芯片识别情况

<NewCodeBlock tip="user@linux$" type="host">

```
sudo flashrom -p ch341a_spi -n
```

</NewCodeBlock>

如果显示类似如下信息，表示芯片识别成功：

```
Found Winbond flash chip "W25Q64.W" (8192 kB, SPI) on ch341a_spi.
```

4. 刷写 BIOS 固件

确保进行此步骤时，编程器和芯片连接稳定，避免刷写过程中断电或连接不稳定导致刷写失败。

当前目录下有需要刷写的 `cix_flash_all.bin` 文件。

<NewCodeBlock tip="user@linux$" type="host">

```
sudo flashrom -p ch341a_spi -w cix_flash_all.bin
```

</NewCodeBlock>

等待刷写完成，显示如下信息表示刷写成功：

```
Verifying flash... VERIFIED.
```

5. 重启系统

更新完成后，重新插拔电源适配器启动系统！
